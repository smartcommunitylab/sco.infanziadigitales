<ion-view id="babyprofile" view-title="{{babyProfile.fullName}}">
    <ion-nav-bar class="bar bar-ungiorno">
        <ion-nav-back-button>
        </ion-nav-back-button>
    </ion-nav-bar>
    <ion-content has-header="true" scroll="false">
        <div>
            <div class="row">
                <div class="col  card profile-column">
                    <div id="kid-profile">
                        <div style="display:inline-block; vertical-align:top;">
                            <img ng-src="{{getProfileImage()}}" style="width: 200px; height: 200px;">
                        </div>
                        <div>
                            <div class=" detailItem" ng-if="babyInformations.active">{{babyProfile.firstName}} {{'is' | translate}} {{babyStatus | uppercase}}</div>
                            <div class=" detailItem" ng-if="!babyInformations.active">{{babyProfile.firstName}}{{'baby_not_monitored' | translate}}</div>
                            <div class=" detailItem" ng-if="babyInformations.exitTime == null && babyInformations.absenceType!=null">{{'absence_type' | translate}} {{babyInformations.absenceType}}</div>
                            <div class=" detailItem" ng-if="babyInformations.exitTime !== null">{{'enter_at' | translate}} {{babyEnterHour}}</div>
                            <div class=" detailItem" ng-if="checkBusServiceActive() && babyInformations.exitTime !== null">{{'bus_stop_back' | translate}} {{babyBusStopBackName}}</div>
                            <div class=" detailItem" ng-if="babyInformations.exitTime !== null && !checkBusServiceActive()">{{'exit_at' | translate}}{{babyInformations.exitTime | date:'HH:mm'}}</div>
                            <div class=" detailItem" ng-if="babyInformations.exitTime !== null && !checkBusServiceActive()">{{'person_who_retire' | translate}}{{babyInformations.personName}} ({{relation}})</div>
                            <div class=" detailItem" style="color: #ff0000;" ng-if="babyInformations.personException && babyInformations.exitTime !== null">{{'extra_delegation' | translate}}</div>
                            <a href="http://www.google.it" class=" detailItem" ng-if="personWhoRetire.isDelegate && babyInformations.exitTime !== null">{{'view_delegation' | translate}}</a>
                        </div>
                    </div>
                    <div ng-if="babyInformations.active">
                        <div>{{'baby_info' | translate}}</div>
                        <br>
                        <div ng-repeat="person in parents track by $index" ng-if="parents.length>0">
                            <div class="row" ng-if="$index%2==0">
                                <div class="col">
                                    <div class=" detailsTitle">{{'parent' | translate}}{{$index+1}}</div>
                                    <div>{{parents[$index].fullName}}</div>
                                    <ion-list>
                                        <ion-item ng-repeat="num in parents[$index].phone" ng-click="callPhone('{{num}}');">
                                            <i class="icon voice-menu ion-ios-telephone" style="margin-right: 20px;"></i>{{num}}
                                        </ion-item>
                                    </ion-list>
                                </div>
                                <div class="col" ng-if="parents.length> ($index + 2)">
                                    <div class=" detailsTitle">{{'parent' | translate}}{{$index+2}}</div>
                                    <div>{{parents[$index+1].fullName}}</div>
                                    <ion-list>
                                        <ion-item ng-repeat="num in parents[$index+1].phone" ng-click="callPhone('{{num}}');">
                                            <i class="icon voice-menu ion-ios-telephone" style="margin-right: 20px;"></i>{{num}}
                                        </ion-item>
                                    </ion-list>
                                </div>
                            </div>
                        </div>
                        <div ng-if="parents.length==0">
                            No parents
                        </div>


                        <div class="row">
                            <div class="col">
                                <div class=" detailsTitle" ng-hide="babyProfile.allergies.length==0">{{'food_allergies' | translate}}</div>
                                <ion-list ng-hide="babyProfile.allergies.length==0">
                                    <ion-item ng-repeat="allergia in babyProfile.allergies">
                                        <i class="voice-menu" style="margin-right: 20px;"></i>{{allergia.name}}
                                    </ion-item>
                                </ion-list>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col col-30  card profile-column">
                    <div class="no-messages-placeholder" ng-if="messages[babyProfile.kidId].length === 0 ">
                        {{'no_messages' | translate}}
                    </div>
                    <ion-scroll direction="y" id="chat-box" delegate-handle="handler" on-scroll="refresh()">
                        <ion-spinner ng-if="loading" icon="spiral"></ion-spinner>

                        <ion-item ng-repeat="ms in messages[babyProfile.kidId]">

                            <div class="dateOfChatMessage">
                                <label ng-if="isToday(ms.creationDate) && isANewDate($index)">{{'lbl_today' | translate}} </label>
                                <label ng-if="isYesterday(ms.creationDate) && isANewDate($index)">{{'lbl_yesterday' | translate}} </label>
                                <label ng-if="!isToday(ms.creationDate) && !isYesterday(ms.creationDate) && isANewDate($index)">{{ ms.creationDate | date: dateDayMask }} </label>
                            </div>
                            <div ng-class="{'message-container-parent': isMe(ms.sender), 'message-container-teacher': !isMe(ms.sender) }" class="message-container">
                                <div id="{{ ms.creationDate }}" class="card-chat" ng-class="{'card-chat-my': (isMe(ms.sender) && !chatExtraLength(ms.text)), 'card-chat-my-extra': (isMe(ms.sender) && chatExtraLength(ms.text))}">
                                    <!--
new versione
                                    <div class="item">
                                        <span>{{ ms.text }}</span>
                                    </div>
                                    <div ng-if="!isMe(ms.sender)" class="item item-divider parent-label" ng-init="checkMessage(ms)">
                                        <span>{{ ms.author.name }} {{ ms.author.surname }} </span><span class="chat-time">{{ ms.creationDate | date:'HH:mm' }}</span>
                                    </div>
                                    <div class="item item-divider" ng-if="isMe(ms.sender)">
                                        <span><i class="icon ion-checkmark-round" ng-class="{'message-flag': ms.seen}"></i><i class="icon ion-checkmark-round" ng-class="{'message-flag':  ms.received}"></i></span><span class="chat-time">{{ ms.creationDate | date:'HH:mm' }}</span><span class="teacher-label" ng-if="isMe(ms.sender)">{{ ms.author.name }} {{ ms.author.surname }} </span>
                                    </div>
-->
                                    <!--
old version
                                    <div ng-if="!isMe(ms.sender)" class="item item-divider" ng-init="checkMessage(ms)">
                                        <span>{{ ms.teacherId }} </span>
                                    </div>
                                    <div class="item">
                                        <span>{{ ms.text }}</span>
                                    </div>
                                    <div class="item item-divider">
                                        <span ng-if="isMe(ms.sender)"><i class="icon ion-checkmark-round" ng-class="{'message-flag': ms.seen}"></i><i class="icon ion-checkmark-round" ng-class="{'message-flag':  ms.received}"></i></span> {{ ms.creationDate | date:'HH:mm' }}
                                    </div>
-->
                                    <div class="item">
                                        <span>{{ ms.text }}</span>
                                    </div>
                                    <div ng-if="!isMe(ms.sender)" class="item item-divider parent-label" ng-init="checkMessage(ms)">
                                        <span>{{ ms.author.name }} {{ ms.author.surname }} </span><span class="chat-time">{{ ms.creationDate | date:'HH:mm' }}</span>
                                    </div>

                                    <div class="item item-divider" ng-if="isMe(ms.sender)">
                                        <span><i class="icon ion-checkmark-round" ng-class="{'message-flag': ms.seen}"></i><i ng-if="ms.received" class="icon ion-checkmark-round" ng-class="{'message-flag': ms.seen}"></i></span><span class="chat-time">{{ ms.creationDate | date:'HH:mm' }}</span><span class="teacher-label">{{ ms.author.name }} {{ ms.author.surname }} </span>
                                        <!--                            <span><i class="icon ion-checkmark-round" ng-class="{'message-flag': ms.seen}"></i><i class="icon ion-checkmark-round" ng-class="{'message-flag':  ms.received}"></i></span><span class="chat-time">{{ ms.creationDate | date:'HH:mm' }}</span>-->
                                    </div>
                                </div>
                            </div>
                        </ion-item>
                        <ion-item ng-class="{'disabled': !userAction.typing}">
                            <div class="message-container-parent message-container">
                                <div class="card-chat">
                                    <div class="item item-divider">
                                    </div>
                                    <div class="item">
                                        <span class="loading"></span>
                                    </div>

                                </div>
                            </div>
                        </ion-item>
                        <!--                        <div class="loading" ng-show="userAction.typing"></div>-->
                    </ion-scroll>
                    <!--                    </ion-content>-->

                    <div class="bar bar-subfooter item-input chat-teacher-input auto-height">
                        <div class="row chat-chose">
                            <div class="input-label">
                                {{'chat_teacher_label'|translate}}
                            </div>

                            <select ng-model="teacher" ng-init="teacher=teachers[0]" options-class="{'teacher-option':true}" ng-options="teacher.teacherFullname for teacher in teachers" ng-change="changeTeacher(teacher)"> </select>
                            <!--
                            <select ng-model="teacher" ng-init="teacher=teachers[0]" ng-change="changeTeacher(teacher)">
                                <option class="teacher-option">ciao</option>
                            </select>
-->
                            <div class="input-label">
                                {{'chat_write_label'|translate}}
                            </div>
                        </div>
                        <div class="row chat-write">
                            <input type="text " placeholder="{{ 'send_msg_placeholder' | translate}} " ng-model="newMessage.text" ng-focus="inputUp() " ng-blur="inputDown() " ng-keyup="$event.keyCode == 13 ? sendMessage(newMessage.text) : startTyping()">
                            <button class="button button-carpooling icon ion-android-send " ng-click="sendMessage(newMessage.text) ">

                            </button>
                        </div>
                    </div>

    </ion-content>

    </div>
    </div>


    </div>
    </div>
    <!--        </ion-content>-->
</ion-view>
